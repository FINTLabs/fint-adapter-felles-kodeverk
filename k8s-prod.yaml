apiVersion: apps/v1
kind: Deployment
metadata:
  name: adapter-felles-kodeverk
spec:
  strategy:
    rollingUpdate:
      maxSurge: 1
      maxUnavailable: 0
  selector:
    matchLabels:
      app: adapter-felles-kodeverk
  template:
    metadata:
      labels:
        app: adapter-felles-kodeverk
    spec:
      restartPolicy: Always
      hostAliases:
        - ip: "137.117.232.241"
          hostnames:
            - api.felleskomponent.no
      containers:
      - name: adapter-felles-kodeverk
        image: fintlabs.azurecr.io/adapter-felles-kodeverk:1.0.0
        resources:
          limits:
            memory: "2Gi"
            cpu: "2"
          requests:
            memory: "1Gi"
            cpu: "250m"
        ports:
          - containerPort: 8091
        readinessProbe:
          httpGet:
            path: /health
            port: 8091
          initialDelaySeconds: 60
          timeoutSeconds: 5
        env:
          - name: TZ
            value: Europe/Oslo
          - name: JAVA_TOOL_OPTIONS
            value: '-XX:+ExitOnOutOfMemoryError -Xmx1G -verbose:gc'
          - name: springfox.title
            value: "Felles kodeverk Adapter"
          - name: fint.adapter.organizations
            value: fintlabs.no
          - name: fint.adapter.sse-endpoint
            value: https://api.felleskomponent.no/felles/kodeverk/provider/sse/%s
          - name: fint.adapter.status-endpoint
            value: https://api.felleskomponent.no/felles/kodeverk/provider/status
          - name: fint.adapter.response-endpoint
            value: https://api.felleskomponent.no/felles/kodeverk/provider/response
          - name: fint.oauth.enabled
            value: "true"
          - name: fint.oauth.access-token-uri
            value: https://idp.felleskomponent.no/nidp/oauth/nam/token
          - name: fint.oauth.scope
            value: fint-client
          - name: fint.oauth.client-id
            valueFrom:
              secretKeyRef:
                key: client-id
                name: fake-adapter
          - name: fint.oauth.client-secret
            valueFrom:
              secretKeyRef:
                key: client-secret
                name: fake-adapter
          - name: fint.oauth.username
            valueFrom:
              secretKeyRef:
                key: username
                name: fake-adapter
          - name: fint.oauth.password
            valueFrom:
              secretKeyRef:
                key: password
                name: fake-adapter
          # - name: fint.adapter.ssb-klass.valid-to
          #   value: "2017-12-31"
          - name: fint.adapter.ssb-klass.interval
            value: "0 0 9-17 * * MON-FRI"
